package basicsofhibernate;

import static org.junit.jupiter.api.Assertions.assertNotNull;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import com.product.Product;
import com.product.ProductCRUD;

public class ProductCrudTest {
	
	static EntityManagerFactory emf ;
	EntityManager em ;
	EntityTransaction et = em.getTransaction();
	

	@BeforeAll
	public static void initEmf() {
		System.out.println("init emf");
		emf = Persistence.createEntityManagerFactory("postgres");
	}
	
	@BeforeEach
	public void initEM() {
		System.out.println("init em");
	}

	@Test
	public void addProductTest() {
		
		System.out.println("Product Insert");
		ProductCRUD crud = new ProductCRUD();
		
		Product p = new Product();
		p.setId(102);
		p.setName("Powder");
		p.setPrice(90);
		p.setQuantity(100);
		
		crud.addProducts(et, em,p);
		crud.deleteProducts(et, em, 102);
	}
	
	
	@Test
	public void testFindByIDTest() {
		Product p = em.find(Product.class, 101);
		assertNotNull(p);
	}
	
	
	@AfterAll
	public static void destroyEMF() {
		System.out.println("emf closing");
		emf.close();
	}
	
	@AfterEach
	public void destroyEM() {
		System.out.println("em closing");
		em.close();
	}
	
}
